{% extends "bootstrap/base.html" %}
{% block module_title %}Console{% endblock %}
{% block custom_scripts %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
<script>
	var enter_key = 13;
	$(document).ready(function() {
		newInputLine();
		$("#terminal").bind("click", function(){
			$(".readLine.active").focus();
		});
	});
	
	function sendCommand(args) {
		$.post("/console/command", args, function(data) {
			$(".line.active").append($("<pre>").text(data));
			newInputLine();
		});
	}
	
	function processInput(value){
		if(value.length > 0) {
			args = value.split(" ");
			if(args.length > 0) {
				switch(args[0]) {
					case "stats":
						args.length > 0 ? sendCommand({'command' : 'stats', 'args' : args[1]}) : sendCommand({'command' : 'stats'});
						break;
					case "clear":
						clearConsole();
						break;
					case "help":
						printHelp();
						break;
				}
			}
		} else {
			newInputLine();
		}
	}
	
	function newInputLine() {
		activeInput = $(".readLine.active");
		if(activeInput.length > 0) {
			activeInput.unbind("keydown");
			activeInput.removeClass("active");
			activeInput.attr("disabled", "disabled");
			activeDiv = $(".line.active");
			activeDiv.removeClass("active");
		}
		$("div#terminal").append($('<div>').attr("class", "line active").html('<span class="prompt"> &gt;</span><input type="text" class="readLine active">'));
		activeInput = $(".readLine.active");
		bindInput(activeInput);
		activeInput.focus();
	}
	
	function bindInput(obj) {
		obj.bind("keydown", function(ev) {
			switch (ev.keyCode) {
				case enter_key:
					processInput(this.value);
				break;
			}
		});
	}
	
	function clearConsole() {
		$("div#terminal").html("");
		newInputLine();
	}
	
	
	function printHelp() {
		$("div#terminal").append($('<p>').html('HELP'));
		$("div#terminal").append($('<p>').html('memcached commands'));
		$("div#terminal").append($('<pre>').html('	stats			General statistics'));
		$("div#terminal").append($('<pre>').html('	stats items		Returns information about item storage per slab'));
		$("div#terminal").append($('<pre>').html('	stats settings		Returns details of the settings of the running memcached'));
		$("div#terminal").append($('<pre>').html('	stats sizes		Returns information about the general size and count of all items stored in the cache'));
		$("div#terminal").append($('<pre>').html('	stats slabs		Returns information about each of the slabs'));
		
		$("div#terminal").append($('<p>').html('marmaladed commands'));
		$("div#terminal").append($('<pre>').html('	clear	Clear the console screen'));
		$("div#terminal").append($('<pre>').html('	help	Print the help'));
		/*
		PTAG('Note: Only a subset of MongoDB\'s features are provided here.') +
		PTAG('For everything else, download and install at mongodb.org.') +
		PTAG('db.foo.help() help on collection methods') +
		PTAG('db.foo.find() list objects in collection foo') +
		PTAG('db.foo.save({a: 1}) save a document to collection foo') +
		PTAG('db.foo.update({a: 1}, {a: 2}) update document where a == 1') +
		PTAG('db.foo.find({a: 1}) list objects in foo where a == 1') +
		PTAG('it use to further iterate over a cursor');*/
		newInputLine();
	}
</script>
{% endblock %}
{% block content %}
<div id="masthead"></div>
<section id="about">
	<div class="page-header">
		<h1><small>Memcached browser </small>console</h1>
	</div>
	<div class="row">
		<div class="span16">
			<div id="terminal">
				<p>type "help" for help</p>
			</div>
		</div>
	</div>
</section>
{% endblock %}